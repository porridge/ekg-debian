Date: Fri, 16 Nov 2001 23:53:53 +0100
From: Marek Kozina <klith@hybrid.art.pl>
To: wojtekka@irc.pl
Subject: ekg -> patch

sle Ci takiego prymitywnego patcha z nowym expandem w chat_header i msg_header
ktory wyswietli nam czas podany przez serwer, czyli bedzie to takze czas, ten
o ktorym pisalem Ci wczesniej, jak ktos mesgal i nas nie bylo...
patchyk jest prymitywny, ale sprawdzalem czy te czasy sprawdzaja sie z tymi
w win-gg i wychodzi na to, ze im tam ta tym serwerze spiesza zegarki
troszku :))
bzz, zmienilem jeszcze Makefile.in bo sie papralo, tzn dlugo sie kompilowalo
a wlasciwie to chodzi o to, ze mam wolnego kopma i przy kazdej poprawce
musze jeszcze raz kompilowac libgg i libgg_search :P

p.


diff -u2 ekg-20011116/Makefile.in ekg-20011116-new/Makefile.in
--- ekg-20011116/Makefile.in	Fri Nov 16 23:09:17 2001
+++ ekg-20011116-new/Makefile.in	Sun Nov 11 00:10:36 2001
@@ -12,5 +12,5 @@
 
 CFLAGS = @DFLAGS@ @CFLAGS@ $(INCLUDES)
-OBJS = stuff.o commands.o events.o themes.o vars.o dynstuff.o
+OBJS = libgg.o libgg_search.o stuff.o commands.o events.o themes.o vars.o dynstuff.o
 
 all:	ekg
Common subdirectories: ekg-20011116/docs and ekg-20011116-new/docs
diff -u2 ekg-20011116/events.c ekg-20011116-new/events.c
--- ekg-20011116/events.c	Thu Nov 15 20:41:00 2001
+++ ekg-20011116-new/events.c	Fri Nov 16 23:02:09 2001
@@ -61,4 +61,6 @@
 	int chat = ((e->event.msg.msgclass & 0x0f) == GG_CLASS_CHAT);
 	char sender[100];
+	struct tm *tm;
+	char czas[100];
 
 	if (is_ignored(e->event.msg.sender))
@@ -74,6 +76,9 @@
 	}	
 
+	tm = localtime(&e->event.msg.time);
+	strftime(czas, 100, find_format("timestamp"), tm);
+
 	cp_to_iso(e->event.msg.message);
-	my_printf((chat) ? "chat_header" : "message_header", format_user(e->event.msg.sender));
+	my_printf((chat) ? "chat_header" : "message_header", format_user(e->event.msg.sender), czas);
 
 	print_message_body(e->event.msg.message, chat);
Common subdirectories: ekg-20011116/examples and ekg-20011116-new/examples
diff -u2 ekg-20011116/libgg.c ekg-20011116-new/libgg.c
--- ekg-20011116/libgg.c	Sun Nov  4 17:14:33 2001
+++ ekg-20011116-new/libgg.c	Fri Nov 16 22:36:29 2001
@@ -894,4 +894,5 @@
 			e->event.msg.sender = fix32(r->sender);
 			e->event.msg.message = strdup((char*) r + sizeof(*r));
+			e->event.msg.time = fix32(r->time);
 		}
 	}
diff -u2 ekg-20011116/libgg.h ekg-20011116-new/libgg.h
--- ekg-20011116/libgg.h	Sun Nov 11 22:57:04 2001
+++ ekg-20011116-new/libgg.h	Fri Nov 16 22:29:52 2001
@@ -130,4 +130,5 @@
                         uin_t sender;
 			int msgclass;
+			time_t time;
                         unsigned char *message;
                 } msg;
Common subdirectories: ekg-20011116/themes and ekg-20011116-new/themes
