# $Id$

prefix = @prefix@
datadir = @datadir@
mandir = @mandir@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

MAKE = @MAKE@
INSTALL = @INSTALL@

#

all:	configure libgadu @ekg@ @make_ekgwap@

libgadu:
	cd lib && $(MAKE) all

ekg:	
	cd src && $(MAKE) all

make-ekgwap:
	cd ekgwap && $(MAKE) all

examples:
	cd examples && $(MAKE) all

#

configure:	configure.in m4/*
	./autogen.sh

#

install:	all install-libgadu @install_ekg@ @install_ekgwap@

install-libgadu:
	cd lib && $(MAKE) install

install-ekg:	install-ekg-themes install-ekg-man install-ekgsearch
	cd src && $(MAKE) install

install-ekg-themes:
	$(INSTALL) -d $(DESTDIR)$(datadir)/ekg/themes
	$(INSTALL) -m 644 themes/*.theme $(DESTDIR)$(datadir)/ekg/themes

install-ekg-man:
	$(INSTALL) -d $(DESTDIR)$(mandir)/man1
	$(INSTALL) -m 644 docs/ekg.man.en $(DESTDIR)$(mandir)/man1/ekg.1
	$(INSTALL) -m 644 docs/ekgsearch.man.en $(DESTDIR)$(mandir)/man1/ekgsearch.1
	$(INSTALL) -d $(DESTDIR)$(mandir)/pl/man1
	$(INSTALL) -m 644 docs/ekg.man.pl $(DESTDIR)$(mandir)/pl/man1/ekg.1
	$(INSTALL) -m 644 docs/ekgsearch.man.pl $(DESTDIR)$(mandir)/pl/man1/ekgsearch.1

install-ekgsearch:
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(INSTALL) -m 755 contrib/ekgsearch $(DESTDIR)$(bindir)

install-ekgwap:
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(INSTALL) -m 755 ekgwap/ekgwapd $(DESTDIR)$(bindir)

#

uninstall:	@uninstall_ekg@
	rm -f $(DESTDIR)$(libdir)/libgadu.{a,so*}
	rm -f $(DESTDIR)$(includedir)/libgadu.h

uninstall-ekg:
	rm -f $(DESTDIR)$(bindir)/{ekg,ekgsearch,ekgwapd}
	rm -f $(DESTDIR)$(libexecdir)/ioctld
	rm -rf $(DESTDIR)$(datadir)/ekg
	rm -f $(DESTDIR)$(mandir){/pl,}/man1/ekg{,search}

#

clean:	clean-libgadu @clean_ekg@ clean-examples clean-compat

clean-libgadu:
	cd lib && $(MAKE) clean

clean-ekg:
	cd src && $(MAKE) clean

clean-examples:
	cd examples && $(MAKE) clean

clean-compat:
	cd compat && rm -f *.o *~

#

distclean:	distclean-libgadu @distclean_ekg@ distclean-examples distclean-compat
	rm -f *~ config.log config.cache config.status config.h Makefile
	rm -f config.h.in configure aclocal.m4

distclean-libgadu:
	cd lib && $(MAKE) distclean

distclean-ekg:
	cd src && $(MAKE) distclean

distclean-examples:
	cd examples && $(MAKE) distclean

distclean-compat:
	cd compat && rm -f *.o *~
