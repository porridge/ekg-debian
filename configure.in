dnl $Id$

AC_INIT(lib/libgadu.h)

PACKAGE=ekg
VERSION=0.9

AC_CONFIG_HEADER(config.h)

AC_PROG_CC
AC_PROG_MAKE_SET
AC_PROG_INSTALL

AC_SUBST(DFLAGS)

AC_ARG_WITH(debug, 
  [  --without-debug  	  Compile without debug [-Wall, -ggdb]])

if test "x$with_debug" = "xno"; then 
  DFLAGS=""
else
  DFLAGS="-Wall -ggdb" 
fi

AC_ARG_WITH(termcap, 
  [  --without-termcap       Used to force curses/ncurses])

if test "x$with_termcap" = "xno"; then 
  TERMCAP_LIB=""
else
  AC_CHECK_LIB(termcap, tgetent, TERMCAP_LIB=-ltermcap)
  LIBS="$LIBS $TERMCAP_LIB"
fi

if test "x$TERMCAP_LIB" = "x"; then 
   AC_CHECK_CURSES
fi

AC_CHECK_READLINE

if test "x$READLINE_LIBS" = "x"; then
    AC_MSG_RESULT([not found])
    AC_MSG_ERROR([You need both readline and readline-devel packages.])
fi

SAVE_LIBS="$LIBS"
LIBS="$LIBS $READLINE_LIBS"

AC_CACHE_CHECK([for rl_set_prompt() in readline], ac_cv_has_rl_set_prompt,
[AC_TRY_LINK([#include <stdio.h>
#include <readline/readline.h>
], [rl_set_prompt("");], [ac_cv_has_rl_set_prompt=yes], [ac_cv_has_rl_set_prompt=no])])
if test x"$ac_cv_has_rl_set_prompt" != xno; then
    AC_DEFINE(HAS_RL_SET_PROMPT)
fi

AC_CACHE_CHECK([for rl_filename_completion_function() in readline], ac_cv_has_rl_completion,
[AC_TRY_LINK([#include <stdio.h>
#include <readline/readline.h>
], [char *x = rl_filename_completion_function("", 0);], [ac_cv_has_rl_completion=yes], [ac_cv_has_rl_completion=no])])
if test x"$ac_cv_has_rl_completion" != xno; then
    AC_DEFINE(HAS_RL_COMPLETION)
fi

LIBS="$SAVE_LIBS"

AC_PATH_PROG(RM, rm, no)
if test "x$RM" = "xno"; then
    AC_MSG_ERROR([rm ])
fi

AC_PATH_PROG(GMAKE, gmake, no)
if test "x$GMAKE" = "xno"; then
    AC_PATH_PROG(MAKE, make, no)
    if test "x$MAKE" = "xno"; then
	AC_MSG_ERROR([make ])
    fi
else
    MAKE=$GMAKE
fi


AC_PATH_PROG(AR, ar, no)
if test "x$AR" = "xno"; then
    AC_MSG_ERROR([ar ])
fi

AC_C_BIGENDIAN

AC_CHECK_LIB(nsl, t_accept, LIBS="$LIBS -lnsl")
AC_CHECK_LIB(socket, socket, LIBS="$LIBS -lsocket")

AC_SUBST(do_ioctl)

AC_ARG_WITH(do_ioctl, 
  [  --without-ioctl  	  Compile without ioctl deamon [linux specific]])

if test "x$do_ioctl" = "xno"; then 
  do_ioctl=""
else
  do_ioctl="ioctl_daemon" 
fi


if test ! -e  config.h; then 
    echo -n "ordering CD from http://dev.null.pl/ekg/CD $ac_c" 1>&6
    sleep 1
    echo -n ".$ac_c" 1>&6
    sleep 1
    echo -n ".$ac_c" 1>&6
    sleep 1
    echo -n ".$ac_c" 1>&6
    sleep 1
    AC_MSG_RESULT([ just kidding :)])
fi

AC_OUTPUT(Makefile lib/Makefile src/Makefile examples/Makefile)
    echo "----------------------------------------------------------------"
    echo "configure is DONE!"
    echo "----------------------------------------------------------------"
